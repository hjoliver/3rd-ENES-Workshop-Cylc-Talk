<!doctype html>
<html lang="en">
  <head>
    <!-- font-face rule needed here not in css file to avoid CORS block? -->
    <style>
@font-face {
  font-family: 'Titillium';
  font-style: normal;
  font-weight: 400;
  src: local('TitilliumWeb'),
  url('fonts/TitilliumWeb/TitilliumWeb-Regular.WOFF')
  format('woff');
}
    </style>
    <link rel="stylesheet" href="css/index.css" />
    <link rel="stylesheet" href="css/print.css" />
    <link rel="stylesheet" href="highlight/styles/solarized-light.css">
  </head>
  <body>

    <div id="impress" data-transition-duration="1000">

      <div id="title" class="step image" data-x="0" data-y="0"
        data-scale="3">
        <img src="img/supercomputer2.jpg" 
             style="width:100%; position:absolute; top:15%"
             alt="supercomputer" 
             />
        <div style="position:absolute; left:100px; top:12%; color:white;
        text-shadow: 0 2px 2px #000; text-align:center">
          <h1 style="margin-top:5%; margin-bottom:300px">Cylc: The Path To
            Exascale</h1>
          <h3 style="color:white; margin-top:-10%">Hilary, Oliver, Dave<br/>
            3rd ENES Workshop on Workflows<br/>
            13 September 2018</h3>
        </div>
       <div class="notes">
        </div>
      </div>

      <!-- Contents -->
      <div id="contents" class="step" data-rel-x="500" data-rel-y="2500"
           data-scale="4">
        <ul style="margin-top:20%">
          <li><img src="img/hilary.jpg" style="height:40px"/>
            Exascale Workflow?</li>
          <li><img src="img/hilary.jpg" style="height:40px"/>
            Cylc (Re-)Introduction</li>
          <li><img src="img/hilary.jpg" style="height:40px"/>
            Exascale Challenges</li>
          <li><img src="img/oliver.jpg" style="height:40px"/>
            Meeting the Challenges of Exascale</li>
          <li><img src="img/dave.jpg" style="height:40px"/>
            Introduction to Rose</li>
        </ul>
      </div>

      <!-- Prelude -->
      <div id="prelude" class="step" data-rel-x="3000" data-rel-y="-3500">
        <h1>Exascale Workflow??</h1>
        <p><i>What do we mean by this?</i></p>
        <div class="person">
          <img src="img/hilary.jpg" />
          <div class="text">
            <span class="name">Hilary Oliver</span>
            <br />
            <span class="description">NIWA (NZ)</span>
          </div>
        </div>
      </div>
 
    <div class="step" data-rel-x=1500 data-rel-y=0>
        <h1>Exascale Computing</h1>
        <ul>
            <li> early-mid 2020s?
              <ul>
                <li> Aurora - Argonne Lab USA, Cray, 2021?</li>
              </ul>
            </li> 
            <li> 1 exaflop = a quintillion (a billion billion) flops
              <ul>
                <li> approx. processing power of the human brain?</li>
                <li> 1/10 flops per individual insect on planet earth!</li>
              </ul>
            </li>
            <li> challenges?
              <ul>
                <li> hardware (and power 40MW = $US 40M/year)</li>
                <li> software scaling</li>
                <li> workflow?...</li> 
              </ul>
            </li>
        </ul>

        <div class="notes">
          <ul>
            <li> at any given time, it is estimated that there are ten
              quintillion (10,000,000,000,000,000,000) individual insects
              alive on earth</li>
            <li> my son once said his shoe size was 2 limes and a sandwich.</li>
          </ul>
        </div>
    </div>

    <div class="step" data-rotate="60">
        <h1>Exascale Workflow?</h1>
        <img src="img/exa-workflow-1.svg" 
             style="display:block; margin:auto"
             alt="Exascale Workflow 1"/>
        <p>(we've got this covered)</p>
        <div class="notes">
        </div>
    </div>

    <div class="step image" data-rotate="60">
        <img src="img/stormtrooper-duck.png" 
             alt="Exascale Workflow 2" 
             style="width:100%; position:absolute; top:15%"/>
        <div style="position:absolute; left:65%; top:50%; width:290px;
          font-size:90%">
          workflow automation is critical to utilizing these massive
          rescources
        </div>
        <div class="notes">
          <p>Even if you think the primary purpose of these machines is for
          massive exascale models, much of the time will still be spent
          running ensembles of (somewhat) smaller models, and processing the
          vast amounts of data generated by them....</p>
        </div>
    </div>

    <div class="step image" data-rotate="30">
        <img src="img/mo-exascale-prog-scope.png" 
             style="width:100%; margin-top:15%"
             alt="MO Exascale Scope" 
             class="right"/>
        <div class="notes">
        </div>
    </div>


      <!-- Introduction -->
      <div id="intro" class="step" data-rel-x="0" data-rel-y="1000"
        data-rel-to="prelude">
        <h1>Cylc (Re-)Introduction</h1>
        <p><i>The Cylc Workflow Engine</i></p>
        <div class="person">
          <img src="img/hilary.jpg" />
          <div class="text">
            <span class="name">Hilary Oliver</span>
            <br />
            <span class="description">NIWA (NZ)</span>
          </div>
        </div>
        <br />
        <br />
        <ul>
          <li> cycling workflows </li>
          <li> workflow definition </li>
          <li> architecture </li>
          <li> user interface </li>
        </ul>
        <div class="notes">
          Why cycling workflows?
          <ul>
            <li> real time environmental forecasting </li>
            <li> and running the same systems off-the-clock</li>
            <li> split long model integrations into many smaller chunks</li>
            <li> steps in some iterative processes (e.g. model parameter tuning)</li>
            <li> process a series of datasets</li> 
            <li> with <i>pipeline parallelism</i> (or better)</li>
          </ul>
        </div>
      </div>

    <div class="step image" data-rel-x="1500" data-rel-y="0" data-rotate="10">
        <img src="img/cycling-workflow-layer8.png" 
             style="position:absolute; height:100%; left:60px"
             alt="" 
             class=""/>

        <img src="img/cycling-workflow-layer7.png" 
             style="position:absolute;height:100%; left:60px"
             alt="" 
             class="substep"/>
 
        <img src="img/cycling-workflow-layer6.png" 
             style="position:absolute; height:100%; left:60px"
             alt="" 
             class="substep"/>
 
        <img src="img/cycling-workflow-layer5.png" 
             style="position:absolute; height:100%; left:60px"
             alt="" 
             class="substep"/>
 
        <img src="img/cycling-workflow-layer4.png" 
             style="position:absolute; height:100%; left:60px"
             alt="" 
             class="substep"/>
 
        <img src="img/cycling-workflow-layer3.png" 
             style="position:absolute; height:100%; left:60px"
             alt="" 
             class="substep"/>
 
        <img src="img/cycling-workflow-layer2.png" 
             style="position:absolute; height:100%; left:60px"
             alt="" 
             class="substep"/>
 
        <img src="img/cycling-workflow-layer1.png" 
             style="position:absolute; height:100%; left:60px"
             alt="" 
             class="substep"/>
 
        <div class="notes">
        </div>
    </div>

    <div class="step image" data-rotate="20">
        <img src="img/animation-key-1.png" style="height:100%; margin-left:18%"
             alt="animation key" 
             class="center"/>
        <div class="notes">
        </div>
    </div>

    <div class="step image" data-rotate="30">
      <video onclick="this.paused ? this.play() : this.pause();"
        style="width:100%; margin-top:20px">
      <source src="img/cycling-workflow-10-retries.webm">
      Your browser does not support webm video
    </video>
        <div class="notes">
        </div>
    </div>

    <div class="step image" data-rotate="30">
        <img src="img/dep-two-cycles.svg" 
             style="position:absolute; width:100%; top:10%"
             alt="" 
             class=""/>
        <img src="img/timeline-three-a.svg" 
             style="position:absolute; top:60%; width:100%"
             alt="" 
             class="substep"/>
        <img src="img/timeline-three.svg"
             style="position:absolute; top:60%; width:100%"
             alt="" 
             class="substep"/>
        <div class="notes">
        </div>
    </div>

    <div class="step">
      <h2>What is Cylc (currently) Like?</h2>
      <ul>
        <li>complex "macro-scale" cycling workflows in HPC</li>
        <li>text config file (with programmatic templating)
          <ul>
            <li>treat workflow definitions like source code</li>
            <li>efficient: shared config, graph notation, families.</li>
          </ul>
        <li>flexible and general
        <ul>
          <li>ANY date-time or integer cycling sequence</li>
          <li>use any command, script, or program, as a task</li>
          <li>makes no assumptions about data movement</li>
        </ul>
        </li>
        <li>distributed architecture - no central server</li>
      </ul>
      <div class="notes">
        Note a workflow is primarily a configuration of the workflow engine,
        and a config file is easier for most users and most use cases than
        programming to a Python API. However, ...!

        Cylc is not currently so well suited to large numbers of small
        quick-running jobs (later...)
      </div>
    </div>


    <div class="step image">
        <img src="img/cylc-arch.png" style="width:100%; margin-top:40px" alt=""/>
        <div class="notes">
        </div>
    </div>

    <div class="step image">
        <img src="img/gcylc-1.png" 
             style="position:absolute; width:100%; top:25px"
             alt="" 
             class=""/>
        <img src="img/gcylc-3.png" 
             style="position:absolute; width:100%; top:25px"
             alt="" 
             class="substep"/>
        <img src="img/gscan.png" 
             style="position:absolute; width:100%; top:25px"
             alt="" 
             class="substep"/>
        <div class="notes">
        </div>
    </div>
    
    <div class="step" data-rotate="30">
      <img src="img/hello.svg" 
           style="width:35%; position:absolute; top:35%; right:0"
           alt="MO Exascale Scope"/>

      <pre><code class="ini" style="position:absolute; top:0">
# Hello World! Plus
[scheduling]
   [[dependencies]]
       graph = "hello => farewell & goodbye"
      </code></pre>

      <pre class="substep"><code class="ini" style="position:absolute; top:0">
# Hello World! Plus
[scheduling]
   [[dependencies]]
       graph = "hello => farewell & goodbye"
[runtime]
   [[hello]]
       script = echo "Hello World!"
      </code></pre>
      <pre class="substep"><code class="ini" style="position:absolute; top:0">
# Hello World! Plus
[scheduling]
   [[dependencies]]
       graph = "hello => farewell & goodbye"
[runtime]
   [[hello]]
       script = echo "Hello World!"
       [[[environment]]]
           # ...
       [[[remote]]]
           host = hpc1.niwa.co.nz
       [[[job]]]
           batch system = PBS
           # ...
       # ...
   # ...
      </code></pre>

      <div class="notes">
        Plus:
        <ul>
          <li>[runtime] is an inheritance heirarchy for efficient sharing of
            common settings
          </li>
        </ul>
      </div>
    </div>

    <div class="step" data-rotate="30">

      <img src="img/hello-0.svg" 
           style="width:35%; margin-top:10%; display:block; position:absolute;
           right:0"
           alt=""/>

      <img src="img/hello.svg" 
           style="width:35%; margin-top:10%; display:block; position:absolute;
           right:0"
           class="substep"
           alt=""/>

      <pre><code class="ini">
 #!Jinja2
 {% set SAY_BYE = false %}
 [scheduling]
    [[dependencies]]
       graph = """hello
 {% if SAY_BYE %} 
         => goodbye & farewell
 {% endif %}
               """
[runtime]
    # ...
      </code></pre>
        <div class="notes">
        </div>
    </div>

    <div class="step image" data-rotate="90">
      <img src="img/ensemble1.svg" 
           style="position:absolute; top:20%; width:30%"
           alt=""/>
      <img src="img/ensemble2.svg" 
           style="position:absolute; top:5%; right:0; width:55%"
           alt=""
           class="substep"/>
      <img src="img/ens_plain.svg" 
           style="position:absolute; bottom:0; right:0; width:60%"
           alt=""
           class="substep"/>
      <div class="notes">
      </div>
    </div>

    <div class="step" data-rotate="40">
      <img src="img/param-simple.svg" 
           style="width:50%; margin-left:25%"
           alt="" class=""/>
        <pre><code class="ini">[[dependencies]]
   graph = "pre => sim&lt;M&gt; => post&lt;M&gt; => done"
   # with M = 1..5</code></pre>

      <img src="img/params-5.svg" 
           style="width:50%; margin-left:25%"
           alt="" class=""/>
 
      <div class="notes">
      </div>
    </div>

    <div class="step" data-rotate="-30">
      <img src="img/param-simple-2.svg" 
           style="width:70%; margin-left:15%"
           alt="" class=""/>
        <pre><code class="ini" style="font-size:20px">[[dependencies]]
   graph = "prep => init&lt;R&gt; => sim&lt;R,M&gt; => post&lt;R,M&gt; => close&lt;R&gt; => done"
   # with M = a,b,c; and R = 1..3</code></pre>
      <img src="img/params-5-2.svg" 
           style="width:86%; margin-left:7%"
           alt="" class=""/>
      <div class="notes">
      </div>
    </div>

    <div class="step" data-rotate="30">
      <div style="display:block; position:absolute; top:0">
        <pre><code class="ini">
[cylc]
   cycle point format = %Y-%m
[scheduling]
   initial cycle point = 2010-01
   [[dependencies]]
      [[[R1]]]
         graph = "prep => foo"
        </code></pre>
        <div class="notes">
        </div>
      </div>

      <div class="substep" style="display:block; position:absolute; top:0">
        <pre><code class="ini">
[cylc]
   cycle point format = %Y-%m
[scheduling]
   initial cycle point = 2010-01
   [[dependencies]]
      [[[R1]]]
         graph = "prep => foo"
      [[[P1M]]]
         graph = "foo[-P1M] => foo => bar & baz => qux"
        </code></pre>
      </div>

      <div class="substep" style="display:block; position:absolute; top:0;">
        <pre><code class="ini">
[cylc]
   cycle point format = %Y-%m
[scheduling]
   initial cycle point = 2010-01
   [[dependencies]]
      [[[R1]]]
         graph = "prep => foo"
      [[[P1M]]]
         graph = "foo[-P1M] => foo => bar & baz => qux"
      [[[R2/^+P2M/P1M]]]
         graph = "baz & qux[-P2M] => boo"
        </code></pre>
      </div>
      <div class="notes">
      </div>
    </div>

    <div class="step image" data-rotate="90">
      <img src="img/cycling-suiterc-example.svg" 
           style="height:100%; margin-left:10%"
           alt="">
      <div class="notes">
      </div>
    </div>


      <!-- Exascale I -->
      <div id="exa1" class="step" data-rel-x="0" data-rel-y="1000"
        data-rel-to="intro">
        <h1>Exascale Challenges</h1>
        <p><i>Present capabilities and challenges</i></p>
        <div class="person">
          <img src="img/hilary.jpg" />
          <div class="text">
            <span class="name">Hilary Oliver</span>
            <br />
            <span class="description">NIWA (NZ)</span>
          </div>
        </div>
      </div>

    <div class="step image" data-rel-x="1500" data-rel-y="0">
        <img src="img/gcylc-3.png" 
             style="width:100%; margin-top:25px"
             alt="" 
             class=""/>
        <div class="notes">
        </div>
    </div>
 
    <div class="step" data-rotate="30">
      <h2>Immediate: Web GUIs, Python 3</h2>
      <img src="img/cylc-web-arch.png" 
           style="position:absolute; right:0; top:25%"
           alt=""/>
      <div style="position:absolute; width:60%">
      <ul>
        <li>Python 2 is near end of life</li>
        <li>PyGTK GUIs are near obsolete</li>
      </ul>
      <ul>
        <li> web GUI work starting
          <ul> 
            <li>need new architecture!</li>
          </ul>
        </li>
      </ul>
      </div>
      <div class="notes">
      </div>
    </div>

    <div class="step image" data-rotate="60">
        <img src="img/stormtrooper-duck.png" 
             alt="Exascale Workflow 2" 
             style="width:100%; position:absolute; top:15%"/>
        <div style="position:absolute; left:65%; top:50%; width:310px">
         THEN: scaling; config API; visualization;
         light sub-suites... 
        </div>
        <div class="notes">
          <p>Even if the primary purpose of these machines is for massive
          exascale models, much of the time will still be spent running
          large numbers of smaller models, and associated data processing.</p>
        </div>
    </div>

    <div class="step image">
      <img src="img/nzlam-ungrouped-2.svg" 
           style="position:absolute; top:10%; width:100%;"
           alt=""
           class=""/>
      <div class="notes">
        A typical small regional determistic NWP suite, 3 cycles. Obs
        processing tasks in yellow. A few tasks generate thousands of products
        en masse, from a few large model output files.
      </div>
    </div>

    <div class="step image" >
      <img src="img/nzlam-m10.svg" 
           style="margin-left:35%; height:100%"
           alt=""
           class=""/>
      <div class="notes">
        ... now a 10-member ensemble, ~450 tasks (3 cycles).
      </div>
    </div>

    <div class="step image" data-rotate="70">
      <img src="img/nzlam-m30.png" 
           style="position:absolute; top 0; left:40%; height:100%"
           alt=""
           class=""/>
      <img src="img/nzlam-m30-zoom.png" 
           style="position:absolute; top 0; left:20px; height:100%"
           alt=""
           class="substep"/>
 
      <div class="notes">
        ... now a 30-member ensemble, ~1300 tasks (3 cycles).
      </div>
    </div>

    <div class="step" data-rotate="60">
      Easily construct and control ensemble-type Cylc workflows of
          thousands of tasks per cycle
      <ul>
        <li> Tested sans GUI at 50k tasks! (need lots of RAM)</li>
      </ul>
      BUT a problem use case has emerged to point the way: processing
      <i>incremental outputs</i> from model ensembles, for
          verification and product generation
      <ul>
        <li>multi-dimensional dynamic cycling</li>
        <li>or light-weight sub-suites</li>
        <li>bunching many small tasks ... with dependencies</li>
        <li>automatic reconfiguring of huge suites</li>
      </ul> 
      <div class="notes">
        <ul>
          <li>Met Office IMPROVER: 100k <i>jobs</i> per cycle.</li>
        </ul>
      </div>
    </div>

    <div class="step image" data-rotate="10">
      <div style="position:absolute; background:rgb(215,215,215); height:100%;
        width:100%">
        <img src="img/ensemble-post-0.svg" 
             style="margin-left:20%; height:100%"
             alt=""
             class=""/>
      </div>
      <div style="position:absolute; background:rgb(215,215,215); height:100%;
        width:100%" class="substep">
        <img src="img/ensemble-post-1.svg" 
             style="width:100%; margin-top:100px"
             alt=""/>
      </div>
      <div style="position:absolute; background:rgb(215,215,215); height:100%;
        width:100%" class="substep">
        <img src="img/ensemble-post-2.svg" 
           style="width:100%; margin-top:100px"
           alt=""/>
      </div>
       <div class="substep" style="position:absolute; bottom:200px; color:hotpink">
         1 model, 2 files/hour for 10 model-hours, 1 task/file ...
       </div>
       <div class="substep" style="position:absolute; bottom:50px">
         <br/>
         30 members, 7 files/hour for 10 model-days, 5 task/file ... <br/>
         <span style="color:deeppink">30 x 7 x (24x10) x 5 = 250,000 jobs per
         cycle!</span>
       </div>
      <div class="notes">
        5 tasks per file: each of the pink blobs is a workflow!
      </div>
    </div>

    <div class="step">
      0.25M tasks per cycles is way too much for Cylc.
        <ul>
          <li> these tasks totally dominate the workflow</li>
          <li> parameterized "cycle" over forecast hour (1...240)</li>
          <li>can't use efficient dynamic cycling (nested!)</li>
            <li> for now a lot of <i>bunching</i> is required</li>
            <li> or <i>sub-suites</i>, but:
            <ul>
              <li> 30+ suites (per cycle) instead of 1 suite!</li>
              <li> log directory housekeeping?</li>
              <li> start-up, kill, restart, failure recovery etc.?</li>
            </ul>
          </li>
        </ul>
        <div class="notes">
          <ul>
            <li> cylc can have multiple "top-level" cycling sequences in one
              suite</li>
            <li> but not nested cycling</li>
            <li>NOTE: the HPC infrastructure can't handle this yet either!</li>
        </div>
    </div>

    <div class="step">
      <h3>actually it's worse than this!</h3>
      Real post-processing systems may:
        <ul>
          <li>aggregate output from multiple model suites </li>
          <li>have complex verification + product-generation workflows that are
            not bunching-friendly</li>
          <li>require dynamic re-configuration to swap products in and out</li>
        </ul>
        <div class="notes">
          <ul>
            <li> cylc can have multiple "top-level" cycling sequences in one
              suite</li>
            <li> but not nested cycling</li>
        </div>
    </div>

    <div class="step">
      <h3>... the future of cylc</h3>
      (Oliver)
        <ul>
          <li>general efficiency (e.g. don't hold job config in memory)</li>
          <li>event-driven and spawn on demand</li>
          <li>light-weight scheduler kernel for light-weight "sub-suites" that
            don't generate all the usual log files</li>
          <li>Python API </li>
          <li>self-assembling workflow from task inputs and outputs </li>
        </ul>
    </div>


      <!-- Exascale II -->
      <div id="exa2" class="step" data-rel-x="0" data-rel-y="1000"
        data-rel-to="exa1">
        <h1>Meeting Exascale Challenges</h1>
        <p><i>An outline of some potential pathways for future development</i></p>
        <div class="person">
          <img src="img/oliver.jpg" />
          <span class="name">Oliver Sanders</span>
          <br />
          <span class="description">Met Office (UK)</span>
        </div>
      </div>

      <div id="exa2-outline" class="step" data-rel-x="1500" data-rel-y="200">
        <object data="img/bigger.svg" type="image.svg+xml" height="1800px">
        </object>
      </div>

      <div id="exa2-outline-bigger" class="step" data-rel-x="1000" data-rel-y="0">
      </div>

      <div id="exa2-outline-bigger2" class="step" data-rel-x="1000" data-rel-y="0">
      </div>

      <div id="exa2-vis-new-gui" class="step" data-rel-x="2200"
           data-rel-y="-240" data-scale="0.10" data-rel-to="exa2-outline">
      <!--  <h2>The Visualisation Problem</h2>-->
      <!--  <center>-->
      <!--    <object id="graph" data="img/global.svg" type="image/svg+xml">-->
      <!--    </object>-->
      <!--    [><object id="graph" data="img/nzlam-m30.svg" type="image/svg+xml"<]-->
      <!--    [>  width="1000px" height="600px"><]-->
      <!--    </object>-->
      <!--  </center>-->
      <!--  <span class="substep" id="graph-zoom-1"></span>-->
      <!--  <span class="substep" id="graph-zoom-2"></span>-->
      <!--  <span class="substep" id="graph-zoom-3"></span>-->
      <!--</div>-->

      <!--<div id="exa2-vis1" class="step" data-rel-x="150" data-rel-y="0"-->
      <!--     data-scale="0.10">-->
        <h2>New Cylc GUI</h2>
        <img width="250px" height="250px" src="img/html5.png">
        <img width="180px" height="250px" src="img/css3.png">
      </div>

      <div id="exa2-vis-gscan-gcylc" class="step" data-rel-x="75"
           data-rel-y="0" data-scale="0.10">
        <h3>Combine <i>gscan</i> & <i>gcylc</i></h3>
        <img class="full" src="img/gui-gscan-gcylc.png"/>
      </div>

      <div id="exa2-vis-graph-n-edges" class="step" data-rel-x="75"
           data-rel-y="0" data-scale="0.10">
        <h3>View N Edges To Selected Node</h3>
        <img class="full substep flash"
             src="img/gui-graph-limited-nodes-1.svg"
             style="position:absolute;" />
        <img class="full substep flash"
             src="img/gui-graph-limited-nodes-2.svg"
             style="position:absolute;" />
        <!-- TODO - export on a computer with better font support -->
      </div>

      <div id="exa2-vis-alternative-views" class="step" data-rel-x="80"
           data-rel-y="0" data-scale="0.10">
        <h3>Alternative Views</h3>
        <img style="float:left;" class="full" src="img/gant.png" />
        <ul style="float:left;">
          <li>Gant chart</li>
          <li>Adjacency matrix</li>
          <li>Other?</li>
      </div>

      <!--<div id="exa2-vis5" class="step" data-rel-x="60" data-rel-y="0"-->
      <!--     data-scale="0.10">-->
      <!--  <h3>Selecting Tasks Between Views</h3>-->
      <!--  [> TODO - remove image background <]-->
      <!--  <img height="380px" src="img/gui-matrix.png" />-->
      <!--</div>-->

      <div id="exa2-writ-pre" class="step" data-rel-x="-1000"
           data-rel-y="150" data-rel-to="exa2-bigger">
      </div>

      <div id="exa2-writ-modularity-1" class="step" data-rel-x="2200"
           data-rel-y="-110" data-scale="0.10" data-rel-to="exa2-outline">
        <h2>The Modularity Problem</h2>
        <ul>
          <li>We can split the suite.rc into multiple files but...</li>
          <li>Suites are monolithic</li>
          <li>Developing components in isolation is difficult</li>
        </ul>
      </div>

      <div id="exa2-writ-modularity-2" class="step" data-rel-x="110"
           data-rel-y="0" data-scale="0.10">
        <p>It's hard to incorporate a module into a workflow</p>
        <img width="1000px" src="img/sub-workflow-current.png" />
      </div>

      <div id="exa2-writ-modularity-3" class="step" data-rel-x="110"
           data-rel-y="0" data-scale="0.10">
        <p>Ideally we would write dependencies to/from the module itself
        rather than the tasks within it</p>
        <img width="1000px" src="img/sub-workflow.png" />
      </div>

      <div id="exa2-writ-modularity-4" class="step" data-rel-x="110"
           data-rel-y="0" data-scale="0.10">
        <p>Workflows could be represented as tasks</p>
        <img width="500px" src="img/sub-workflow-collapsed.png" />
        <pre>foo => baz => module&lt;param&gt; => pub</pre>
      </div>

      <!--<div id="exa2-writ4" class="step" data-rel-x="110" data-rel-y="0"-->
      <!--     data-scale="0.10">-->
      <!--  <p>Advantages of workflow modules:</p>-->
      <!--  <ul>-->
      <!--    <li>Re-usable workflow components</li>-->
      <!--    <li>The parent workflow remains simple</li>-->
      <!--    <li>Programmatic logic at the correct level (workflow/module)</li>-->
      <!--  </ul>-->
      <!--</div>-->

      <div id="exa2-writ-python-1" class="step" data-rel-x="110" data-rel-y="0"
           data-scale="0.10">
        <h3>Python API</h3>
        <!--<p>For truly programmatic problems Jinja2 doesn't quite cut it!</p>-->
        <p>Python &gt; Jinja2</p>

        <p class="emph">Illustrative examples Python <i>could</i>
        provide Cylc:</p>

        <pre><code class="python">bar = cylc.Task('myscript')

cylc.run(
    foo &gt;&gt; bar &gt;&gt; baz
)</code></pre>
      </div>

      <div id="exa2-writ-python-2" class="step" data-rel-x="110" data-rel-y="0"
           data-scale="0.10">
        <p>Use Python data structures as Cylc parameters:</p>
        <pre><code class="python">animal = cylc.Parameter({
    'cat': {'lives': 9, 'memory': 2},
    'dog': {'lives': 1, 'memory': 10}
})

baz = cylc.TaskArray('run-baz',
    args=('--animal', animal),
    env={'N_LIVES': animal['lives']}),
    directives={'--mem': animal['memory']}
)</code></pre>
      </div>

      <div id="exa2-writ-python-3" class="step" data-rel-x="110" data-rel-y="0"
           data-scale="0.10">
        <p>Use Python to write Cylc modules:</p>
        <pre><code>import my_component
graph = cylc.graph(
    foo &gt;&gt; bar &gt;&gt; my_component &gt;&gt; baz,
    my_component.pub &gt;&gt; qux
)</code></pre>
      </div>

      <div id="exa2-writ-scheduling-paradigms" class="step" data-rel-x="110"
           data-rel-y="0" data-scale="0.10">
        <h3>Alternative Scheduling Paradigms</h3>
        <div style="float: left; margin: 0 50px 0 0;">
          <div class="bubble">Abstract dependency</div>
          <code style="opacity: 0.7"><pre>foo => bar => baz</pre></code>
        </div>
        <div style="float: left; margin: 0 50px 0 0;">
          <div class="bubble">Data dependency</div>
          <code style="opacity: 0.7"><pre>foo:
  out: a
bar:
  in: a
  out: b
baz:
  in: a, b
  out: c</pre></code>
        </div>
        <ul>
          <li>Compute resource dependency?</li>
          <li>Others?</li>
        </ul>
      </div>

      <div id="exa2-writ-pre" class="step" data-rel-x="-1000"
           data-rel-y="150" data-rel-to="exa2-bigger">
      </div>

      <!-- TODO insert slides with profiling results -->

      <div id="exa2-run-scaling" class="step" data-rel-x="2200" data-rel-y="40"
           data-scale="0.10" data-rel-to="exa2-outline">
        <h3>Scaling With Dependencies</h3>
        <p>Cylc can currently scale to tens of thousands of tasks and
        dependencies</p>
        <p>But there are limitations, for example:</p>
      </div>

      <div id="exa2-run-many-many-1" class="step" data-rel-x="110"
           data-rel-y="0" data-scale="0.10">
        <img height="60%" src="img/many-to-many.png" />
        <p>Many to many triggers result in NxM dependencies</p>
      </div>

      <div id="exa2-run-many-many-2" class="step" data-rel-x="110"
           data-rel-y="0" data-scale="0.10">
        <img height="60%" src="img/many-many-as-one.png" />
        <p>Cylc should be able to represent this as a single dependency</p>
      </div>

      <div id="exa2-run-many-many-3" class="step" data-rel-x="110"
           data-rel-y="0" data-scale="0.10">
        <p>The scheduling algorithm currently <i class="emph">iterates</i> over
        a "pool" of tasks.</p>

        <p>We plan to re-write the scheduler using an <i class="emph">event
        driven</i> approach.</p>

        <p>This should make Cylc more
        <i class="emph">efficient</i> and <i class="emph">flexible</i> model
        solving problems like this.</p>
      </div>

      <div id="exa2-run-kernel-shell" class="step" data-rel-x="110"
           data-rel-y="0" data-scale="0.10">
        <h3>Kernel - Shell Architecture</h3>
        <center>
          <p>Working towards a leaner Cylc we plan to separate the codebase into
          a Kernel - Shell model</p>
          <table>
            <tr>
              <td><div class="bubble">Shell</div></td>
              <td><div class="bubble">Kernel</div></td>
            </tr>
            <tr>
              <td class="emph">User Commands</td>
              <td class="emph1">Scheduler</td>
            </tr>
            <tr>
              <td class="emph">Suite Configuration</td>
              <td class="emph1">Job Submission</td>
            </tr>
          </table>
        </center>
      </div>

      <div id="exa2-run-batching-1" class="step" data-rel-x="110"
           data-rel-y="0" data-scale="0.10">
        <h3>Batching Jobs</h3>
        <p>Combining multiple jobs to run in a single job submission.</p>
        <img height="380px" src="img/batched-jobs-2.png" />
      </div>

      <div id="exa2-run-batching-2" class="step" data-rel-x="110"
           data-rel-y="0" data-scale="0.10">
        <h3>Arbitrary Batching</h3>
        <p>A lightweight Cylc kernel could be used to execute a workflow within
        a job submission.</p>
        <div style="float:left;width:50%;">
          <img height="380px" src="img/batched-jobs-3.png" />
        </div>
        <div style="float:left;width:50%;">
          <ul>
            <li class="small">The same Cylc scheduling algorithm</li>
            <li class="small">No need for job submission</li>
            <li class="small">Different approach to log / output files</li>
          </ul>
        </div>
      </div>

      <div id="exa2-summary" class="step" data-rel-x="3700" data-rel-y="0"
           data-rel-to="exa2-outline">
        <h2>Future Challenges</h2>
        <ul>
          <li>Container technology</li>
          <li>Computing in the cloud</li>
          <li>File system usage</li>
        </ul>
      </div>

      <!-- Rose -->
      <div id="rose" class="step" data-rel-x="0" data-rel-y="1000"
        data-rel-to="exa2">
        <h1>Introduction to Rose</h1>
        <p><i>Storage and configuration of complex Cylc workflows</i></p>
        <div class="person">
          <img src="img/dave.jpg" />
          <div class="text">
            <span class="name">David Matthews</span>
            <br />
            <span class="description">Met Office (UK)</span>
          </div>
        </div>
      </div>

      <div id="rose-history" class="step" data-rel-x="1500" data-rel-y="0">
        <h2>History</h2>
        <p>Development started late 2011 around the time we chose cylc as our workflow tool</p>
      </div>

      <div id="rose-motivation" class="step" data-rel-x="1500" data-rel-y="0">
        <h2>Motivation</h2>
        <ul style="position: absolute" class="substep flash">
          <li>GUI for application configuration</li>
          <li>Suite version control & identification</li>
          <li><i>Enable support of multiple workflow tools</i></li>
          <ul>
            <li><i>Cylc may not have worked out?</i></li>
            <li></i>Collaborators might require other tools?</i></li>
          </ul>
          <li><i>Provide essential features which were outside of the Cylc vision</i></li>
        </ul>
        <ul style="position: absolute" class="substep flash">
          <li>GUI for application configuration</li>
          <li>Suite version control & identification</li>
          <li class="strike"><i>Enable support of multiple workflow tools</i></li>
          <ul>
            <li class="strike"><i>Cylc may not have worked out?</i></li>
            <li class="strike">
              </i>Collaborators might require other tools?</i></li>
          </ul>
          <li class="strike">
            <i>Provide essential features which were outside of the Cylc
            vision</i></li>
        </ul>
      </div>

      <div id="rose-move-to-cylc" class="step" data-rel-x="1500" data-rel-y="0">
        <p>Tools which have moved / will move into Cylc</p>
        <ul>
          <li style="color:rgb(0,150,0)">Log file retrieval</li>
          <li style="color:rgb(0,150,0)">Email notifications</li>

          <li style="color:rgb(0,0,150)">
            rose bush - log file viewer</li>
          <li style="color:rgb(0,0,150)">
            rose suite-run - suite installation</li>

          <li style="color:rgb(150,0,0)">
            rose host-select -> cluster support</li>
          <li style="color:rgb(150,0,0)">
            rose bunch - run multiple small tasks in one job</li>
          <li style="color:rgb(150,0,0)">Housekeeping</li>
        </ul>
      </div>

      <div id="rose-remaining" class="step" data-rel-x="1500" data-rel-y="0">
        <h2>Tools which will remain in Rose</h2>
        <p>rose edit / task-run - Application configuration</p>
        <p>rosie - suite storage and discovery</p>
        <p>(plus a fewer smaller, more specialised utilities)</p>
      </div>


      <div id="rose-apps-problem" class="step" data-rel-x="1500" data-rel-y="0">
        <h2>Application configuration: The problem</h2>
        <p>Tasks may be complex to define, requiring</p>
        <ul>
          <li>setting environment variables</li>
          <li>input files (containing namelists or otherwise)</li>
          <li>scripts</li>
          <li>etc</li>
        </ul>
      </div>

      <div id="rose-apps-why" class="step" data-rel-x="1500" data-rel-y="0">
        <h2></h2>
        <p>Rose applications provide a convenient way to encapsulate all of this
          configuration, storing it all in one place to make it easier to handle
          and maintain.</p>
        <p>In <i>suite.rc</i>:</p>
        <pre><code class="ini">[runtime]
    [[hello]]
        script = rose task-run</code></pre>
        <p>This will run an app config named "hello" (by default)</p>
      </div>

      <div id="rose-apps-config" class="step" data-rel-x="1500" data-rel-y="0">
        <p>An app config is a directory containing a file named <i>rose-app.conf</i></p>
        <p>Simple ini style format (similar to Cylc <i>suite.rc</i>)</p>
        <p>Describes:</p>
        <ul>
          <li>command to run</li>
          <li>environment variables</li>
          <li>input files containing namelists</li>
          <li>files to install (copy, link, export from Subversion)</li>
        </ul>
      </div>

      <div id="rose-apps-eg" class="step" data-rel-x="1500" data-rel-y="0">
        <h2><i>rose-app.conf</i> example</h2>
        <pre><code class="ini">[command]
default=echo "Hello ${WORLD}!"
[env]
WORLD=Earth
[file:input.nml]
source=namelist:latlon
[namelist:latlon]
latitude=52.168
longitude=5.744</code></pre>
      </div>

      <div id="rose-apps-directory" class="step" data-rel-x="1500" data-rel-y="0">
        <p>App config directory may also contain other directories:</p>
        <ul>
          <li><b>bin/</b> - executables
            (automatically added to $PATH when running the app)</li>
          <li><b>file/</b> - static input files which are automatically
            copied into the working directory when the app runs</li>
          <li><b>meta/</b> - metadata file describing app configuration</li>
        </ul>
      </div>

      <div id="rose-apps-metadata" class="step" data-rel-x="1500"
           data-rel-y="0">
        <h2>Metadata - What's it used for?</h2>
        <p>Documenting settings</p>
        <p>Performing automatic checking (e.g. type checking)</p>
        <p>Formatting the rose config-edit GUI</p>
      </div>

      <div id="rose-metadata-eg" class="step" data-rel-x="1500" data-rel-y="0">
        <h2></h2>
        <p><i>rose-app.conf</i>:</p>
        <pre><code class="ini">[env]
WORLD=Earth</code></pre>
        <p><i>meta/rose-meta.conf</i>:</p>
        <pre><code class="ini">[env=WORLD]
description=The name of the world to say hello to
values=Mercury, Venus, Earth, Mars, Jupiter,
      =Saturn, Uranus, Neptune</code></pre>
      </div>

      <div id="rose-macro-eg" class="step" data-rel-x="1500" data-rel-y="0">
        <h2></h2>
        <p>Example: if we were to change the value of WORLD to Pluto</p>
        <pre><code class="bash">$ rose macro -V
Value Pluto not in allowed values
['Mercury', 'Venus', 'Earth', 'Mars', 'Jupiter',
'Saturn', 'Uranus', 'Neptune']
        </code></pre>
      </div>

      <div id="rose-edit-eg" class="step image" data-rel-x="1500" data-rel-y="0">
        <img src="img/rose-edit-1.png"
             style="position:absolute; height:90%"
             alt="" 
             class=""/>
        <img src="img/rose-edit-2.png"
             style="position:absolute; height:90%"
             alt="" 
             class="substep"/>
        <img src="img/rose-edit-1.png"
             style="position:absolute; height:90%"
             alt="" 
             class="substep"/>
        <img src="img/rose-edit-3.png"
             style="position:absolute; height:90%"
             alt="" 
             class="substep"/>
        <img src="img/rose-edit-4.png"
             style="position:absolute; height:90%"
             alt="" 
             class="substep"/>
        <img src="img/rose-edit-5.png"
             style="position:absolute; height:90%"
             alt="" 
             class="substep"/>
        <img src="img/rose-edit-6.png"
             style="position:absolute; height:90%"
             alt="" 
             class="substep"/>
      </div>

      <div id="rose-metadata-location" class="step" data-rel-x="1500" data-rel-y="0">
        <h2>Metadata location</h2>
        <p>metadata can be local to the app or centrally installed (e.g. the metadata for a particular model release)</p>
        <p><i>rose-app.conf</i>:</p>
        <pre><code class="ini">meta=um-atmos/vn11.1</code></pre>
      </div>

      <div id="rose-macros" class="step" data-rel-x="1500" data-rel-y="0">
        <h2>rose macro - usage</h2>
        <ul>
          <li><b>Validation</b></li>
          <ul>
            <li>check against metadata</li>
            <li>custom - e.g. check config meets requirements for a production run</li>
          </ul>
          <li><b>Transformation</b></li>
          <ul>
            <li>add, delete, rename variables, etc</li>
            <li>e.g. upgrade to new model release</li>
          </ul>
        </ul>
      </div>

      <div id="rose-apps-opt-config" class="step" data-rel-x="1500" data-rel-y="0">
        <h2>Optional configs</h2>
        <p>Configuration files which can add to or overwrite the default
          <i>rose-app.conf</i> configuration.<br>
          Used for minor variants, e.g.</p>
        <ul>
          <li>Ensembles</li>
          <li>Modifed behaviour on task retry</li>
          <li>Different times of day</li>
          <li>Site config differences</li>
        </ul>
      </div>

      <div id="rose-apps-summary" class="step" data-rel-x="1500" data-rel-y="0">
        <h2>Why Use Rose App Configs?</h2>
        <p>Encapsulate required inputs and environment required in a simple human-readable configuration.</p>
        <p>Settings can have associated metadata & macros.</p>
        <p>Edit using a text editor or with rose config-edit GUI.</p>
        <p>Optional configurations avoid the need to duplicate app configs for minor variants</p>
      </div>

      <div id="rosie" class="step" data-rel-x="1500" data-rel-y="0">
        <h2>rosie - suite storage & discovery</h2>
        <p>Suites are version controlled using Subversion</p>
        <ul>
          <li>Each suite has its own trunk</li>
          <li>Branches can be used for developing changes, etc</li>
        </ul>
        <p>Each Rosie suite is assigned a unique name.<br>
          e.g.: <i>mo-aa001</i></p>
      </div>

      <div id="rosie-meta" class="step" data-rel-x="1500" data-rel-y="0">
        <p>Each suite has a <i>rose-suite.info</i> file which provides information about the suite. e.g.</p>
        <pre><code class="ini">title=PS40 high resolution trial
project=global-nwp-trial
description=Copy of u-af326/trunk@23458
owner=davidmatthews
access-list=oliversanders</code></pre>
        <p>Particular projects can define their own metadata requirements which are enforced.</p>
      </div>

      <div id="rosie-meta-gui" class="step" data-rel-x="1500" data-rel-y="0">
        <img src="img/rosie-info.png" 
             style="width:100%"
             alt="rosie info" 
             />
      </div>

      <div id="rosie-features" class="step" data-rel-x="1500" data-rel-y="0">
        <h2>rosie features</h2>
        <ul>
          <li><b>Create a copy</b> of a suite (with a new unique name)</li>
          <li><b>Checkout suites</b></li>
          <li><b>Lookup suites</b> (using the metadata)</li>
        </ul>
        <p>Use from the command line or use the GUI</p>
      </div>

      <div id="rosie-go" class="step" data-rel-x="1500" data-rel-y="0">
        <img src="img/rosie-go-annotated.png" 
             style="width:100%"
             alt="rosie info" 
             />
      </div>

      <div id="rosie-summary" class="step" data-rel-x="1500" data-rel-y="0">
        <h2>Why Consider Using Rosie?</h2>
        <p>You want to take advantage of the suite storage, identification and discovery features</p>
        <p><b style="margin-left:30px;" class="emph">And</b></p>
        <p>You're comfortable using Subversion for version control</p>
      </div>

      <div id="rose-roadmap" class="step" data-rel-x="1500" data-rel-y="0">
        <h2>Rose: Roadmap</h2>
        <p>Complete migration of Rose functionality into Cylc.</p>
        <p>Replace current GTK based GUIs with plugins to Cylc web GUI.</p>
        <p>Port to Python 3.</p>
      </div>

      <div id="overview" class="step" data-x="4500" data-y="2500"
           data-scale="10" style="pointer-events: none;">
      </div>

    </div>

<!--
    Add navigation-ui controls: back, forward and a select list.
    Add a progress indicator bar (current step / all steps)
-->
<div id="impress-toolbar"></div>
<div class="impress-progressbar"><div></div></div>
<div class="impress-progress"></div>

    <script type="text/javascript" src="highlight/highlight.cylc.pack.js"></script>
    <script type="text/javascript" src="js/impress.js"></script>
    <script type="text/javascript" src="js/index.js"></script>

  </body>
</html>
